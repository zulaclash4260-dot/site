# ๐ ุจุฑุฑุณ ฺฉุงูู ุฑุจุงุช - ูุดฺฉูุงุช ู ูพุดููุงุฏุงุช ุจูุจูุฏ

## ๐ ูุดฺฉูุงุช ุดูุงุณุง ุดุฏู

### 1. ุงููุช - ุชูฺฉู ุฑุจุงุช ุฏุฑ ฺฉุฏ (ุจุญุฑุงู โ๏ธ)
**ูุงู:** `src/config.js`
**ูุดฺฉู:** ุชูฺฉู ุฑุจุงุช (`TOKEN`) ุจู ุตูุฑุช ูุงุฑุฏฺฉุฏ ุฏุฑ ุณูุฑุณ ฺฉุฏ ูุฑุงุฑ ุฏุงุฑุฏ. ุงฺฏุฑ ุณูุฑุณ ฺฉุฏ ุจู ุตูุฑุช ุนููู ููุชุดุฑ ุดูุฏุ ูุฑ ฺฉุณ ูโุชูุงูุฏ ุฑุจุงุช ุฑุง ฺฉูุชุฑู ฺฉูุฏ.
**ุฑุงูโุญู:** ุงุฒ ูุชุบุฑูุง ูุญุท (`.env`) ุจุฑุง ุฐุฎุฑู ุชูฺฉู ุงุณุชูุงุฏู ุดูุฏ:
```js
const TOKEN = process.env.BOT_TOKEN;
```

### 2. ุงููุช - ุดูุงุณู ุงุฏููโูุง ุฏุฑ ฺฉุฏ (ุจุญุฑุงู โ๏ธ)
**ูุงู:** `src/config.js`
**ูุดฺฉู:** ุดูุงุณูโูุง ุงุฏูู ุจู ุตูุฑุช ุซุงุจุช ุฏุฑ ฺฉุฏ ุชุนุฑู ุดุฏูโุงูุฏ.
**ุฑุงูโุญู:** ุงุฒ ูุชุบุฑ ูุญุท ุง ุฏุชุงุจุณ ุฎูุงูุฏู ุดููุฏ.

### 3. ุนููฺฉุฑุฏ - ุฎูุงูุฏู ูฺฉุฑุฑ ฺฉู ุฏุชุงุจุณ (`readDB`)
**ูุงู:** `db.js`
**ูุดฺฉู:** ุชุงุจุน `readDB()` ุฏุฑ ูุฑ ุฏุฑุฎูุงุณุชุ ุชูุงู ุฌุฏุงูู (ฺฉุงุฑุจุฑุงูุ ูุงูโูุงุ ุชูุธูุงุช ู ุบุฑู) ุฑุง ฺฉุฌุง ูโุฎูุงูุฏ. ุจุง ุงูุฒุงุด ุชุนุฏุงุฏ ฺฉุงุฑุจุฑุงู ู ูุงูโูุงุ ุงู ุนููุงุช ฺฉูุฏ ู ูพุฑูุฒูู ูโุดูุฏ.
**ุฑุงูโุญู:** ุจู ุฌุง ุฎูุงูุฏู ุชูุงู ุฏุชุงุจุณุ ููุท ุฏุงุฏูโูุง ููุฑุฏ ูุงุฒ ูุฑ ุนููุงุช ุฎูุงูุฏู ุดูุฏ. ุงุฒ ฺฉุดโ ููุดููุฏ ู invalidation ููุงุณุจ ุงุณุชูุงุฏู ุดูุฏ.

### 4. ุนููฺฉุฑุฏ - ุฐุฎุฑู ุฏุชุงุจุณ ุจุนุฏ ุงุฒ ูุฑ ฺฉูุฆุฑ
**ูุงู:** `db.js` - ุชุงุจุน `runQuery`
**ูุดฺฉู:** ุจุนุฏ ุงุฒ ูุฑ ุนููุงุช ููุดุชูุ ฺฉู ุฏุชุงุจุณ ุจู ูุงู ููุดุชู ูโุดูุฏ (`persistDatabase()`). ุงู ุนููุงุช I/O ุณูฺฏู ุงุณุช.
**ุฑุงูโุญู:** ุฐุฎุฑูโุณุงุฒ ุฑุง ุจุง debounce ุง ุฏุฑ ุจุงุฒูโูุง ุฒูุงู ูุดุฎุต (ูุซูุงู ูุฑ ต ุซุงูู) ุงูุฌุงู ุฏูุฏ. ุง ุงุฒ `better-sqlite3` ุจู ุฌุง `sql.js` ุงุณุชูุงุฏู ฺฉูุฏ ฺฉู ุฐุงุชุงู ูุงูโูุญูุฑ ุงุณุช ู ูุงุฒ ุจู ุฐุฎุฑู ุฏุณุช ูุฏุงุฑุฏ.

### 5. ุฎุทุง - `getQuery` ุจุฏูู `await` ุฏุฑ `admin.js`
**ูุงู:** `src/admin.js` - ุชุงุจุน `showForceJoinStats`
**ูุดฺฉู:** ุฏุฑ ุฎุทูุท ดฒถ ู ดตดุ ุชุงุจุน `getQuery` ุจุฏูู `await` ูุฑุงุฎูุงู ุดุฏู ุงุณุช. ุงฺฏุฑฺู `getQuery` ุฏุฑ ุญุงู ุญุงุถุฑ ููฺฏุงู (sync) ุงุณุชุ ูู ุฎูุงูุง ู ุณุงุฒฺฏุงุฑ ุจุง ุชุบุฑุงุช ุขูุฏู ูุดฺฉูโุณุงุฒ ุฎูุงูุฏ ุจูุฏ.
**ุฑุงูโุญู:** `await` ูุจู ุงุฒ `getQuery` ุงุถุงูู ุดูุฏ.

### 6. ุนุฏู ูุฏุฑุช ุฎุทุง ุฏุฑ `setTimeout` ุจุฑุง ุญุฐู ูุงู
**ูุงู:** `src/fileManager.js` - ุชุงุจุน `sendFileContent`
**ูุดฺฉู:** ุชุงูุฑ ุญุฐู ูุงู ุจุง `setTimeout` ุชูุธู ูโุดูุฏ. ุงฺฏุฑ ุฑุจุงุช ุฑโุงุณุชุงุฑุช ุดูุฏุ ุชุงูุฑูุง ุงุฒ ุจู ูโุฑููุฏ ู ูุงูโูุง ุญุฐู ูุฎูุงููุฏ ุดุฏ.
**ุฑุงูโุญู:** ุฒูุงู ุญุฐู ูุงูโูุง ุฑุง ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ฺฉุฑุฏู ู ุจุง ฺฉ cron job ุง interval ุจุฑุฑุณ ุดูุฏ.

### 7. ูุดฺฉู `generateFileIdentifier` - ุงุญุชูุงู ุชฺฉุฑุงุฑ ุจูุฏู
**ูุงู:** `src/helpers.js`
**ูุดฺฉู:** ุชุงุจุน `generateFileIdentifier` ุงุฒ `Math.random()` ุงุณุชูุงุฏู ูโฺฉูุฏ ฺฉู ููฺฉู ุงุณุช ููุงุฏุฑ ุชฺฉุฑุงุฑ ุชููุฏ ฺฉูุฏ.
**ุฑุงูโุญู:** ุงุฒ UUID v4 ุง ุชุฑฺฉุจ timestamp + random ุงุณุชูุงุฏู ุดูุฏ. ููฺูู ูุจู ุงุฒ ุฐุฎุฑูุ ูุฌูุฏ ุดูุงุณู ุฏุฑ ุฏุชุงุจุณ ุจุฑุฑุณ ุดูุฏ.

### 8. ุนุฏู ุจุฑุฑุณ ุงุฏูู ุฏุฑ callback queryูุง
**ูุงู:** `index.js`
**ูุดฺฉู:** ุจุฑุฎ ุงุฒ callback queryูุง ุงุฏูู (ูุซู `store_in_channel`ุ `store_group_in_channel`) ุงุฒ ููุชุฑ ุงุฏูู ุงุณุชูุงุฏู ููโฺฉููุฏ. ฺฉ ฺฉุงุฑุจุฑ ุนุงุฏ ููโุชูุงูุฏ ุจู ุฑุงุญุช ุงู callbackูุง ุฑุง ูุนุงู ฺฉูุฏุ ุงูุง ุงุฒ ูุธุฑ ุงููุช ุจูุชุฑ ุงุณุช ุจุฑุฑุณ ุดูุฏ.
**ุฑุงูโุญู:** ููุชุฑ `isAdmin` ุฑุง ุจู ุชูุงู callback queryูุง ูุฑุจูุท ุจู ุงุฏูู ุงุถุงูู ฺฉูุฏ.

### 9. Logger ุชฺฉุฑุงุฑ
**ูุงู:** `src/config.js` ู `db.js`
**ูุดฺฉู:** ูุงฺฏุฑ Winston ุฏุฑ ุฏู ูุงู ุฌุฏุงฺฏุงูู ุจุง ุชูุธูุงุช ูุดุงุจู ุงุฌุงุฏ ุดุฏู. ุงู ุจุงุนุซ ูุงุณุงุฒฺฏุงุฑ ู ูุตุฑู ุงุถุงู ููุงุจุน ูโุดูุฏ.
**ุฑุงูโุญู:** ูุงฺฏุฑ ุฑุง ููุท ุฏุฑ ฺฉ ูุงู (ูุซูุงู `config.js`) ุงุฌุงุฏ ฺฉุฑุฏู ู ุฏุฑ ุจูู ูุงูโูุง ุงุฒ ููุงู import ุดูุฏ.

### 10. ุนุฏู ูุฏุฑุช `forceViewMessageSentTime` ุฏุฑ ุณุดู
**ูุงู:** `src/middleware.js`
**ูุดฺฉู:** ููุฏ `forceViewMessageSentTime` ุฏุฑ initial state ุณุดู ุชุนุฑู ูุดุฏู.
**ุฑุงูโุญู:** ุจู initial state ุณุดู ุงุถุงูู ุดูุฏ:
```js
forceViewMessageSentTime: null,
```

---

## ๐ก ูพุดููุงุฏุงุช ุจูุจูุฏ

### 1. ุงุณุชูุงุฏู ุงุฒ `better-sqlite3` ุจู ุฌุง `sql.js`
`sql.js` ฺฉู ุฏุชุงุจุณ ุฑุง ุฏุฑ ุญุงูุธู ูฺฏู ูโุฏุงุฑุฏ ู ุจุฑุง ูุฑ ุชุบุฑ ุจุงุฏ ฺฉู ูุงู ุจุงุฒููุณ ุดูุฏ. `better-sqlite3` ูุณุชููุงู ุจุง ูุงู ฺฉุงุฑ ูโฺฉูุฏุ ุณุฑุนโุชุฑ ุงุณุช ู ุญุงูุธู ฺฉูุชุฑ ูุตุฑู ูโฺฉูุฏ.

### 2. ุงูุฒูุฏู ุณุณุชู pagination ุจุฑุง ูุณุช ูุงูโูุง
ุจุง ุงูุฒุงุด ุชุนุฏุงุฏ ูุงูโูุงุ ุงุฑุณุงู ููู ููฺฉโูุง ุฏุฑ ฺฉ ูพุงู ููฺฉู ุงุณุช ุจุง ูุญุฏูุฏุช ุชูฺฏุฑุงู ููุงุฌู ุดูุฏ. ุตูุญูโุจูุฏ (pagination) ุจุง ุฏฺฉููโูุง ยซุตูุญู ุจุนุฏยป ู ยซุตูุญู ูุจูยป ุงุถุงูู ุดูุฏ.

### 3. ุงูุฒูุฏู ุงูฺฉุงู ุฌุณุชุฌู ูุงู
ุงูฺฉุงู ุฌุณุชุฌู ูุงู ุจุง ุดูุงุณู ุง ููุน ูุงู ุจู ูพูู ุงุฏูู ุงุถุงูู ุดูุฏ.

### 4. ุงูุฒูุฏู ุขูุงุฑ ูุนุงูุช ุฑูุฒุงูู
ูููุฏุงุฑ ุง ฺฏุฒุงุฑุด ูุนุงูุช ุฑูุฒุงูู/ููุชฺฏ ฺฉุงุฑุจุฑุงู (ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุช ูุงูุ ุชุนุฏุงุฏ ฺฉุงุฑุจุฑุงู ุฌุฏุฏ) ููุฏ ุฎูุงูุฏ ุจูุฏ.

### 5. ุงูุฒูุฏู ูุงุจูุช ูพุดุชุจุงูโฺฏุฑ ุฎูุฏฺฉุงุฑ
ูพุดุชุจุงูโฺฏุฑ ุฏูุฑูโุง ุงุฒ ูุงู ุฏุชุงุจุณ ู ุงุฑุณุงู ุจู ุงุฏูู ุงุฒ ุทุฑู ุฑุจุงุช.

### 6. ุงูุฒูุฏู rate limit ููุดููุฏุชุฑ
ุจู ุฌุง ุจู ฺฉุงูู ฑ ุฏูููโุงุ ุงุฒ ุณุณุชู ุชุฏุฑุฌ ุงุณุชูุงุฏู ุดูุฏ: ุงุจุชุฏุง ูุดุฏุงุฑุ ุณูพุณ ุชุฃุฎุฑ ฺฉูุชุงูุ ู ุฏุฑ ููุงุช ุจู ูููุช.

### 7. ุซุจุช ุขูุงุฑ ุฏููโุชุฑ ุฏุงูููุฏ
ุฐุฎุฑู ุฒูุงู ูุฑ ุฏุงูููุฏ ุจู ููุฑุงู ุดูุงุณู ฺฉุงุฑุจุฑ ุจุฑุง ุชุญูู ุจูุชุฑ ุงูฺฏููุง ุงุณุชูุงุฏู.

### 8. ูพุดุชุจุงู ุงุฒ ฺูุฏ ุฒุจุงูู (i18n)
ุชูุงู ูุชูโูุง ุฑุจุงุช ุฏุฑ ูุงูโูุง ุชุฑุฌูู ุฌุฏุงฺฏุงูู ุฐุฎุฑู ุดููุฏ ุชุง ุงูฺฉุงู ุงูุฒูุฏู ุฒุจุงูโูุง ุฏฺฏุฑ ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ.

### 9. ุจูุจูุฏ ุณุณุชู ุงุฑุณุงู ููฺฏุงู
- ุงูุฒูุฏู ูุงุจูุช ุฒูุงูโุจูุฏ ุงุฑุณุงู (ุงุฑุณุงู ุฏุฑ ุณุงุนุช ูุดุฎุต)
- ุงูุฒูุฏู ูุงุจูุช ูุบู ุงุฑุณุงู ููฺฏุงู ุฏุฑ ุญู ุงุฌุฑุง
- ุงูุฒูุฏู ูุงุจูุช ุงุฑุณุงู ุจู ฺฏุฑูู ุฎุงุต ุงุฒ ฺฉุงุฑุจุฑุงู (ููุชุฑ)

### 10. ุงูุฒูุฏู ุชุณุชโูุง ุฎูุฏฺฉุงุฑ
ูฺ ุชุณุช ุฎูุฏฺฉุงุฑ ุฏุฑ ูพุฑูฺู ูุฌูุฏ ูุฏุงุฑุฏ. ุงุถุงูู ฺฉุฑุฏู unit test ุจุฑุง ุชูุงุจุน ฺฉูุฏ (ูุซู `generateFileIdentifier`ุ `evaluateUserSubscription`ุ `checkUserSubscription`) ุจุงุนุซ ฺฉุงูุด ุจุงฺฏโูุง ู ุงุทููุงู ุงุฒ ุตุญุช ุนููฺฉุฑุฏ ูโุดูุฏ.

### 11. ุจูุจูุฏ ุณุงุฎุชุงุฑ ูพุฑูฺู
- ุฌุฏุง ฺฉุฑุฏู ููุฏูุฑูุง callback query ุฏุฑ ูุงูโูุง ุฌุฏุงฺฏุงูู
- ุงุณุชูุงุฏู ุงุฒ ุงูฺฏู Router ุฏุฑ grammY ุจุฑุง ูุฏุฑุช ุจูุชุฑ ูุณุฑูุง
- ูุงู `index.js` ุจุณุงุฑ ุจุฒุฑฺฏ ุดุฏู ู ุจูุชุฑ ุงุณุช ุจู ูุงูโูุง ฺฉูฺฺฉโุชุฑ ุชูุณู ุดูุฏ

### 12. ูุฏุฑุช ุจูุชุฑ session
ุงุฒ `@grammyjs/storage-*` (ูุซู SQLite storage) ุจุฑุง ุฐุฎุฑู ุณุดูโูุง ุงุณุชูุงุฏู ุดูุฏ ุชุง ุจุง ุฑโุงุณุชุงุฑุช ุฑุจุงุชุ ุณุดูโูุง ุงุฒ ุจู ูุฑููุฏ.
